# Multimodal ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¨­è¨ˆæ›¸

## ğŸ“‹ æ¦‚è¦

| é …ç›® | å†…å®¹ |
|------|------|
| **ã‚¿ã‚¹ã‚¯ID** | TASK-040 ã€œ TASK-046 |
| **ç›®çš„** | AWS Nova ã‚·ãƒªãƒ¼ã‚ºã‚’æ´»ç”¨ã—ãŸãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ« AI æ©Ÿèƒ½ã®æŠ€è¡“æ¤œè¨¼ |
| **å¯¾è±¡ãƒ¢ãƒ‡ãƒ«** | Nova Lite, Nova Pro, Nova Canvas, Nova Reel |
| **ä½œæˆæ—¥** | 2026-01-02 |

---

## ğŸ¯ æ¤œè¨¼ç›®æ¨™

### æ©Ÿèƒ½åˆ¥æ¤œè¨¼é …ç›®

| # | æ©Ÿèƒ½ | å…¥åŠ› | å‡ºåŠ› | AWS ã‚µãƒ¼ãƒ“ã‚¹ |
|---|------|------|------|-------------|
| 1 | **ç”»åƒç†è§£** | ç”»åƒ + ãƒ†ã‚­ã‚¹ãƒˆ | ãƒ†ã‚­ã‚¹ãƒˆ | Nova Pro / Nova Lite |
| 2 | **ç”»åƒç”Ÿæˆ** | ãƒ†ã‚­ã‚¹ãƒˆ | ç”»åƒ | Nova Canvas |
| 3 | **å‹•ç”»ç†è§£** | å‹•ç”» + ãƒ†ã‚­ã‚¹ãƒˆ | ãƒ†ã‚­ã‚¹ãƒˆ | Nova Pro |
| 4 | **å‹•ç”»ç”Ÿæˆ** | ãƒ†ã‚­ã‚¹ãƒˆ / ç”»åƒ | å‹•ç”» | Nova Reel |
| 5 | **è¤‡åˆå…¥åŠ›** | ãƒ†ã‚­ã‚¹ãƒˆ + ç”»åƒ + å‹•ç”» | ãƒ†ã‚­ã‚¹ãƒˆ | Nova Pro |

---

## ğŸ—ï¸ Amazon Nova ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ãƒŸãƒªãƒ¼

### Understanding ãƒ¢ãƒ‡ãƒ«ï¼ˆç†è§£ç³»ï¼‰

| ãƒ¢ãƒ‡ãƒ« | ç‰¹å¾´ | ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ | ä¾¡æ ¼å¸¯ |
|--------|------|-------------|--------|
| **Nova Micro** | ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã€æœ€ä½é…å»¶ | ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã€ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç† | æœ€å®‰ |
| **Nova Lite** | ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«ã€ä½ã‚³ã‚¹ãƒˆ | ç”»åƒ/å‹•ç”»/ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç† | ä½ã€œä¸­ |
| **Nova Pro** | é«˜ç²¾åº¦ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ« | è¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã€é«˜ç²¾åº¦è¦æ±‚ | ä¸­ |
| **Nova Premier** | æœ€é«˜æ€§èƒ½ã€ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ | è¤‡é›‘ãªæ¨è«–ã€æ•™å¸«ãƒ¢ãƒ‡ãƒ« | é«˜ |

### Creative ãƒ¢ãƒ‡ãƒ«ï¼ˆç”Ÿæˆç³»ï¼‰

| ãƒ¢ãƒ‡ãƒ« | ç‰¹å¾´ | å‡ºåŠ›å½¢å¼ | åˆ¶é™ |
|--------|------|---------|------|
| **Nova Canvas** | ç”»åƒç”Ÿæˆãƒ»ç·¨é›† | PNG/JPEG | æœ€å¤§ 4096x4096 |
| **Nova Reel** | å‹•ç”»ç”Ÿæˆ | MP4 | æœ€å¤§ 2åˆ†ã€6ç§’ã‚¯ãƒªãƒƒãƒ— |

---

## ğŸ“ ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Next.js Frontend                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  Multimodal Tester                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚ ç”»åƒ   â”‚ â”‚ ç”»åƒ   â”‚ â”‚ å‹•ç”»   â”‚ â”‚ å‹•ç”»   â”‚            â”‚   â”‚
â”‚  â”‚  â”‚ ç†è§£   â”‚ â”‚ ç”Ÿæˆ   â”‚ â”‚ ç†è§£   â”‚ â”‚ ç”Ÿæˆ   â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚          â”‚          â”‚          â”‚
          â–¼          â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Gateway (REST)                            â”‚
â”‚  POST /v1/multimodal/understand    (ç”»åƒ/å‹•ç”»ç†è§£)               â”‚
â”‚  POST /v1/multimodal/generate      (ç”»åƒ/å‹•ç”»ç”Ÿæˆ)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Multimodal Lambda                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  handler.py                                             â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ understand_image()   # Nova Pro/Lite               â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ understand_video()   # Nova Pro                    â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€ generate_image()     # Nova Canvas                 â”‚     â”‚
â”‚  â”‚  â””â”€â”€ generate_video()     # Nova Reel                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                 â”‚                 â”‚
          â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Bedrock    â”‚  â”‚   S3         â”‚  â”‚   S3         â”‚
â”‚   Runtime    â”‚  â”‚   (Input)    â”‚  â”‚   (Output)   â”‚
â”‚   (Nova)     â”‚  â”‚   Bucket     â”‚  â”‚   Bucket     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ API è¨­è¨ˆ

### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ |
|---------|------|------|
| `POST` | `/v1/multimodal/understand` | ç”»åƒ/å‹•ç”»ç†è§£ |
| `POST` | `/v1/multimodal/generate/image` | ç”»åƒç”Ÿæˆ |
| `POST` | `/v1/multimodal/generate/video` | å‹•ç”»ç”Ÿæˆ |
| `GET` | `/v1/multimodal/status/{jobId}` | éåŒæœŸã‚¸ãƒ§ãƒ–çŠ¶æ…‹ç¢ºèª |

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä»•æ§˜

#### ç”»åƒç†è§£ API

```json
// POST /v1/multimodal/understand
// Request
{
  "type": "image",
  "prompt": "ã“ã®ç”»åƒã«å†™ã£ã¦ã„ã‚‹ã‚‚ã®ã‚’èª¬æ˜ã—ã¦ãã ã•ã„",
  "image": {
    "source": "base64" | "s3",
    "data": "<base64_encoded_image>",  // source=base64 ã®å ´åˆ
    "s3Uri": "s3://bucket/key"          // source=s3 ã®å ´åˆ
  },
  "model": "nova-pro" | "nova-lite"
}

// Response
{
  "result": "ã“ã®ç”»åƒã«ã¯...",
  "model": "amazon.nova-pro-v1:0",
  "usage": {
    "inputTokens": 150,
    "outputTokens": 200
  }
}
```

#### å‹•ç”»ç†è§£ API

```json
// POST /v1/multimodal/understand
// Request
{
  "type": "video",
  "prompt": "ã“ã®å‹•ç”»ã‚’è¦ç´„ã—ã¦ãã ã•ã„",
  "video": {
    "s3Uri": "s3://bucket/video.mp4"
  },
  "model": "nova-pro"
}

// Response
{
  "result": "ã“ã®å‹•ç”»ã§ã¯...",
  "model": "amazon.nova-pro-v1:0",
  "timestamps": [
    {"time": "00:00:05", "description": "..."},
    {"time": "00:00:15", "description": "..."}
  ]
}
```

#### ç”»åƒç”Ÿæˆ API

```json
// POST /v1/multimodal/generate/image
// Request
{
  "prompt": "å¤•æ—¥ã«ç…§ã‚‰ã•ã‚ŒãŸå¯Œå£«å±±ã®ç¾ã—ã„é¢¨æ™¯",
  "negativePrompt": "ä½å“è³ªã€ã¼ã‚„ã‘ãŸ",
  "width": 1024,
  "height": 1024,
  "numberOfImages": 1,
  "seed": 12345
}

// Response
{
  "images": [
    {
      "base64": "<base64_encoded_image>",
      "s3Uri": "s3://output-bucket/generated/xxx.png"
    }
  ],
  "model": "amazon.nova-canvas-v1:0"
}
```

#### å‹•ç”»ç”Ÿæˆ API

```json
// POST /v1/multimodal/generate/video
// Request
{
  "prompt": "æµ·è¾ºã§æ³¢ãŒæ‰“ã¡å¯„ã›ã‚‹æ§˜å­",
  "durationSeconds": 6,
  "fps": 24,
  "dimension": "1280x720"
}

// Response (éåŒæœŸ)
{
  "jobId": "job-12345",
  "status": "IN_PROGRESS",
  "statusUrl": "/v1/multimodal/status/job-12345"
}

// GET /v1/multimodal/status/job-12345
// Response (å®Œäº†æ™‚)
{
  "jobId": "job-12345",
  "status": "COMPLETED",
  "video": {
    "s3Uri": "s3://output-bucket/generated/xxx.mp4",
    "durationSeconds": 6
  }
}
```

---

## ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãƒ»åˆ¶é™

### å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼

| ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¿ã‚¤ãƒ— | å¯¾å¿œå½¢å¼ | æœ€å¤§ã‚µã‚¤ã‚º | å…¥åŠ›æ–¹æ³• |
|----------------|---------|----------|---------|
| **ç”»åƒ** | PNG, JPG, JPEG, GIF, WebP | 25MB (Base64), 1GB (S3) | Base64 / S3 URI |
| **å‹•ç”»** | MP4, MOV, MKV, WebM, FLV, MPEG, WMV, 3GP | 25MB (Base64), 1GB (S3) | Base64 / S3 URI |
| **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** | PDF, DOCX, CSV, XLS, HTML, TXT, MD | 25MB | Bytes / S3 URI |

### å‡ºåŠ›åˆ¶é™

| æ©Ÿèƒ½ | åˆ¶é™ |
|------|------|
| **Nova Canvas (ç”»åƒç”Ÿæˆ)** | æœ€å¤§ 4096x4096 px |
| **Nova Reel (å‹•ç”»ç”Ÿæˆ)** | æœ€å¤§ 2åˆ†ã€6ç§’ã‚¯ãƒªãƒƒãƒ—å˜ä½ |
| **å‹•ç”»ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°** | 1 FPS (16åˆ†ä»¥ä¸‹)ã€960ãƒ•ãƒ¬ãƒ¼ãƒ å›ºå®š (16åˆ†è¶…) |

---

## ğŸ Lambda å®Ÿè£…è¨­è¨ˆ

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
infra/lambda/multimodal-api/
â”œâ”€â”€ handler.py           # ãƒ¡ã‚¤ãƒ³ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”œâ”€â”€ understand.py        # ç”»åƒ/å‹•ç”»ç†è§£ãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ generate.py          # ç”»åƒ/å‹•ç”»ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ s3_utils.py          # S3 æ“ä½œãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â””â”€â”€ requirements.txt     # ä¾å­˜é–¢ä¿‚
```

### handler.py éª¨æ ¼

```python
"""
Multimodal API Lambda Handler

AWS Nova ã‚’ä½¿ç”¨ã—ãŸãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«å‡¦ç†ã€‚
"""

import json
import logging
import os
import boto3

logger = logging.getLogger()
logger.setLevel(os.environ.get("LOG_LEVEL", "INFO"))

bedrock_runtime = boto3.client("bedrock-runtime", region_name="ap-northeast-1")
s3_client = boto3.client("s3")


def lambda_handler(event: dict, context) -> dict:
    """Lambda ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ"""
    path = event.get("path", "")
    method = event.get("httpMethod", "GET")
    body = json.loads(event.get("body") or "{}")

    try:
        if path.endswith("/understand") and method == "POST":
            return handle_understand(body)
        elif path.endswith("/generate/image") and method == "POST":
            return handle_generate_image(body)
        elif path.endswith("/generate/video") and method == "POST":
            return handle_generate_video(body)
        elif "/status/" in path and method == "GET":
            job_id = path.split("/")[-1]
            return handle_status(job_id)
        else:
            return response(404, {"error": "Not Found"})
    except Exception as e:
        logger.exception(f"Error: {e}")
        return response(500, {"error": str(e)})


def handle_understand(body: dict) -> dict:
    """ç”»åƒ/å‹•ç”»ç†è§£"""
    content_type = body.get("type", "image")
    prompt = body.get("prompt", "")
    model_id = get_model_id(body.get("model", "nova-pro"))

    if content_type == "image":
        image_data = body.get("image", {})
        result = understand_image(model_id, prompt, image_data)
    elif content_type == "video":
        video_data = body.get("video", {})
        result = understand_video(model_id, prompt, video_data)
    else:
        return response(400, {"error": f"Unknown type: {content_type}"})

    return response(200, result)


def handle_generate_image(body: dict) -> dict:
    """ç”»åƒç”Ÿæˆ (Nova Canvas)"""
    prompt = body.get("prompt", "")
    negative_prompt = body.get("negativePrompt", "")
    width = body.get("width", 1024)
    height = body.get("height", 1024)
    num_images = body.get("numberOfImages", 1)
    seed = body.get("seed")

    result = generate_image(prompt, negative_prompt, width, height, num_images, seed)
    return response(200, result)


def handle_generate_video(body: dict) -> dict:
    """å‹•ç”»ç”Ÿæˆ (Nova Reel) - éåŒæœŸ"""
    prompt = body.get("prompt", "")
    duration = body.get("durationSeconds", 6)

    job_id = start_video_generation(prompt, duration)
    return response(202, {
        "jobId": job_id,
        "status": "IN_PROGRESS",
        "statusUrl": f"/v1/multimodal/status/{job_id}"
    })


def handle_status(job_id: str) -> dict:
    """éåŒæœŸã‚¸ãƒ§ãƒ–çŠ¶æ…‹ç¢ºèª"""
    status = get_job_status(job_id)
    return response(200, status)


def get_model_id(model: str) -> str:
    """ãƒ¢ãƒ‡ãƒ«åã‹ã‚‰ãƒ¢ãƒ‡ãƒ«IDã‚’å–å¾—"""
    models = {
        "nova-micro": "amazon.nova-micro-v1:0",
        "nova-lite": "amazon.nova-lite-v1:0",
        "nova-pro": "amazon.nova-pro-v1:0",
        "nova-premier": "amazon.nova-premier-v1:0",
        "nova-canvas": "amazon.nova-canvas-v1:0",
        "nova-reel": "amazon.nova-reel-v1:0",
    }
    return models.get(model, "amazon.nova-pro-v1:0")


def response(status_code: int, body: dict) -> dict:
    """API Gateway ãƒ¬ã‚¹ãƒãƒ³ã‚¹"""
    return {
        "statusCode": status_code,
        "headers": {
            "Content-Type": "application/json",
            "Access-Control-Allow-Origin": "*",
            "Access-Control-Allow-Headers": "Content-Type,Authorization",
            "Access-Control-Allow-Methods": "GET,POST,OPTIONS",
        },
        "body": json.dumps(body, ensure_ascii=False, default=str),
    }


# === ç†è§£ç³»å‡¦ç† ===

def understand_image(model_id: str, prompt: str, image_data: dict) -> dict:
    """ç”»åƒç†è§£"""
    # ç”»åƒã‚½ãƒ¼ã‚¹ã®æº–å‚™
    source = image_data.get("source", "base64")
    
    if source == "base64":
        image_content = {
            "image": {
                "format": "png",
                "source": {"bytes": image_data.get("data", "")}
            }
        }
    else:
        image_content = {
            "image": {
                "format": "png",
                "source": {"s3Location": {"uri": image_data.get("s3Uri", "")}}
            }
        }

    # Bedrock Runtime API å‘¼ã³å‡ºã—
    response = bedrock_runtime.converse(
        modelId=model_id,
        messages=[
            {
                "role": "user",
                "content": [
                    image_content,
                    {"text": prompt}
                ]
            }
        ]
    )

    return {
        "result": response["output"]["message"]["content"][0]["text"],
        "model": model_id,
        "usage": response.get("usage", {})
    }


def understand_video(model_id: str, prompt: str, video_data: dict) -> dict:
    """å‹•ç”»ç†è§£"""
    s3_uri = video_data.get("s3Uri", "")
    
    response = bedrock_runtime.converse(
        modelId=model_id,
        messages=[
            {
                "role": "user",
                "content": [
                    {
                        "video": {
                            "format": "mp4",
                            "source": {"s3Location": {"uri": s3_uri}}
                        }
                    },
                    {"text": prompt}
                ]
            }
        ]
    )

    return {
        "result": response["output"]["message"]["content"][0]["text"],
        "model": model_id,
        "usage": response.get("usage", {})
    }


# === ç”Ÿæˆç³»å‡¦ç† ===

def generate_image(prompt: str, negative_prompt: str, width: int, height: int, num_images: int, seed: int = None) -> dict:
    """ç”»åƒç”Ÿæˆ (Nova Canvas)"""
    model_id = "amazon.nova-canvas-v1:0"
    
    body = {
        "taskType": "TEXT_IMAGE",
        "textToImageParams": {
            "text": prompt,
            "negativeText": negative_prompt,
        },
        "imageGenerationConfig": {
            "width": width,
            "height": height,
            "numberOfImages": num_images,
        }
    }
    
    if seed is not None:
        body["imageGenerationConfig"]["seed"] = seed

    response = bedrock_runtime.invoke_model(
        modelId=model_id,
        body=json.dumps(body),
        contentType="application/json",
        accept="application/json"
    )

    result = json.loads(response["body"].read())
    
    return {
        "images": [{"base64": img} for img in result.get("images", [])],
        "model": model_id
    }


def start_video_generation(prompt: str, duration: int) -> str:
    """å‹•ç”»ç”Ÿæˆé–‹å§‹ (éåŒæœŸ)"""
    model_id = "amazon.nova-reel-v1:0"
    output_bucket = os.environ.get("OUTPUT_BUCKET", "rd-knowledge-multimodal-output")
    
    import uuid
    job_id = str(uuid.uuid4())
    
    body = {
        "taskType": "TEXT_VIDEO",
        "textToVideoParams": {
            "text": prompt,
        },
        "videoGenerationConfig": {
            "durationSeconds": duration,
            "fps": 24,
            "dimension": "1280x720",
            "seed": 12345,
        }
    }

    # StartAsyncInvoke ã§éåŒæœŸå®Ÿè¡Œ
    response = bedrock_runtime.start_async_invoke(
        modelId=model_id,
        modelInput=body,
        outputDataConfig={
            "s3OutputDataConfig": {
                "s3Uri": f"s3://{output_bucket}/generated/{job_id}/"
            }
        }
    )
    
    return response.get("invocationArn", job_id)


def get_job_status(job_id: str) -> dict:
    """éåŒæœŸã‚¸ãƒ§ãƒ–çŠ¶æ…‹å–å¾—"""
    try:
        response = bedrock_runtime.get_async_invoke(
            invocationArn=job_id
        )
        
        status = response.get("status", "UNKNOWN")
        result = {"jobId": job_id, "status": status}
        
        if status == "Completed":
            result["video"] = {
                "s3Uri": response.get("outputDataConfig", {}).get("s3OutputDataConfig", {}).get("s3Uri", "")
            }
        elif status == "Failed":
            result["error"] = response.get("failureMessage", "Unknown error")
            
        return result
    except Exception as e:
        return {"jobId": job_id, "status": "UNKNOWN", "error": str(e)}
```

---

## ğŸ¨ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ UI è¨­è¨ˆ

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

```
app/components/Multimodal/
â”œâ”€â”€ MultimodalTester.tsx      # ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ ImageUnderstand.tsx       # ç”»åƒç†è§£ãƒ‘ãƒãƒ«
â”œâ”€â”€ ImageGenerate.tsx         # ç”»åƒç”Ÿæˆãƒ‘ãƒãƒ«
â”œâ”€â”€ VideoUnderstand.tsx       # å‹•ç”»ç†è§£ãƒ‘ãƒãƒ«
â”œâ”€â”€ VideoGenerate.tsx         # å‹•ç”»ç”Ÿæˆãƒ‘ãƒãƒ«
â”œâ”€â”€ FileUploader.tsx          # ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
â”œâ”€â”€ ResultDisplay.tsx         # çµæœè¡¨ç¤º
â””â”€â”€ index.ts                  # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
```

### UI ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¨ Multimodal Tester                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ ç”»åƒç†è§£ â”‚ â”‚ ç”»åƒç”Ÿæˆ â”‚ â”‚ å‹•ç”»ç†è§£ â”‚ â”‚ å‹•ç”»ç”Ÿæˆ â”‚           â”‚
â”‚  â”‚ (Active)â”‚ â”‚         â”‚ â”‚         â”‚ â”‚         â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“¤ ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚                                               â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ— ã¾ãŸã¯ ã‚¯ãƒªãƒƒã‚¯ã§é¸æŠ      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                               â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ: [_________________________________]      â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  [ğŸš€ å®Ÿè¡Œ]                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“Š çµæœ                                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  [ç”»åƒ/å‹•ç”»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼]                         â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  èª¬æ˜: ã“ã®ç”»åƒã«ã¯...                                â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  ä½¿ç”¨ãƒˆãƒ¼ã‚¯ãƒ³: å…¥åŠ› 150 / å‡ºåŠ› 200                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’° ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Š

### Nova ãƒ¢ãƒ‡ãƒ«ä¾¡æ ¼ (ap-northeast-1)

| ãƒ¢ãƒ‡ãƒ« | å…¥åŠ› (1K tokens) | å‡ºåŠ› (1K tokens) | ç”»åƒ (1æš) |
|--------|-----------------|-----------------|-----------|
| Nova Micro | $0.000035 | $0.00014 | - |
| Nova Lite | $0.00006 | $0.00024 | - |
| Nova Pro | $0.0008 | $0.0032 | - |
| Nova Canvas | - | - | $0.04 |
| Nova Reel | - | - | $0.08/ç§’ |

### æœˆé¡è¦‹ç©ã‚‚ã‚Šï¼ˆæ¤œè¨¼ç”¨é€”ï¼‰

| é …ç›® | ä½¿ç”¨é‡ | æœˆé¡ã‚³ã‚¹ãƒˆ |
|------|-------|----------|
| ç”»åƒç†è§£ (Nova Pro) | 1,000å› | ~$5 |
| å‹•ç”»ç†è§£ (Nova Pro) | 100å› | ~$30 |
| ç”»åƒç”Ÿæˆ (Nova Canvas) | 500æš | ~$20 |
| å‹•ç”»ç”Ÿæˆ (Nova Reel) | 50å› (6ç§’) | ~$24 |
| S3 ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | 10GB | ~$0.25 |
| Lambda | 10,000å› | ~$1 |
| API Gateway | 10,000å› | ~$0.35 |
| **åˆè¨ˆ** | | **~$80/æœˆ** |

---

## ğŸ” IAM ãƒãƒªã‚·ãƒ¼

### Lambda å®Ÿè¡Œãƒ­ãƒ¼ãƒ«è¿½åŠ ãƒãƒªã‚·ãƒ¼

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "bedrock:InvokeModel",
        "bedrock:InvokeModelWithResponseStream",
        "bedrock:StartAsyncInvoke",
        "bedrock:GetAsyncInvoke"
      ],
      "Resource": [
        "arn:aws:bedrock:ap-northeast-1::foundation-model/amazon.nova-*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::rd-knowledge-multimodal-*",
        "arn:aws:s3:::rd-knowledge-multimodal-*/*"
      ]
    }
  ]
}
```

---

## âœ… å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 7 ã‚¿ã‚¹ã‚¯

- [x] TASK-040: Nova Vision èª¿æŸ»ãƒ»è¨­è¨ˆ (æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ)
- [ ] TASK-041: ç”»åƒèªè­˜ Lambda å®Ÿè£…
- [ ] TASK-042: ç”»åƒç”Ÿæˆ Lambda å®Ÿè£…
- [ ] TASK-043: å‹•ç”»èªè­˜ Lambda å®Ÿè£…
- [ ] TASK-044: å‹•ç”»ç”Ÿæˆ Lambda å®Ÿè£…
- [ ] TASK-045: Multimodal CDK æ›´æ–°
- [ ] TASK-046: Multimodal UI å®Ÿè£…

---

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Amazon Nova User Guide](https://docs.aws.amazon.com/nova/latest/userguide/)
- [Multimodal support for Amazon Nova](https://docs.aws.amazon.com/nova/latest/userguide/modalities.html)
- [Vision understanding prompting best practices](https://docs.aws.amazon.com/nova/latest/userguide/prompting-video-understanding.html)
- [Amazon Bedrock Knowledge Bases - Multimodal](https://docs.aws.amazon.com/bedrock/latest/userguide/kb-multimodal.html)
- [Nova Canvas (ç”»åƒç”Ÿæˆ)](https://docs.aws.amazon.com/nova/latest/userguide/image-gen-access.html)
- [Nova Reel (å‹•ç”»ç”Ÿæˆ)](https://docs.aws.amazon.com/nova/latest/userguide/video-generation.html)

